<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Videos - Hunting Chronicle's</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        html {
            scroll-behavior: smooth;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-300 font-sans">

    <header class="fixed top-0 left-0 right-0 z-10 bg-gray-900/90 shadow-lg backdrop-blur-sm">
        <nav class="container mx-auto px-4 py-3">
            <div class="flex justify-between items-center">
                <div class="hidden md:flex md:flex-1 md:justify-center space-x-6" id="desktopNav">
                    <a href="index.html" class="hover:text-orange-500 transition duration-300">Home</a>
                    <a href="journal.html" class="hover:text-orange-500 transition duration-300">Journal</a>
                    <a href="gallery.html" class="hover:text-orange-500 transition duration-300">Trophy Room</a>
                    <a href="videos.html" class="hover:text-orange-500 transition duration-300">Videos</a>
                    <a href="contact.html" class="hover:text-orange-500 transition duration-300">Uploads</a>
                </div>
                <button id="mobileMenuButton" class="block md:hidden ml-auto flex-shrink-0 text-gray-200 hover:text-orange-500" aria-label="Open menu" aria-expanded="false" aria-controls="mobileNav">
                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>
        </nav>
        <div id="mobileBackdrop" class="md:hidden fixed inset-0 bg-black/50 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-300 ease-out z-40"></div>
        <div id="mobileNav" class="md:hidden fixed top-16 left-0 right-0 border-t border-gray-800 bg-gray-900/95 shadow-2xl transform -translate-y-full transition-transform duration-300 ease-out overflow-hidden z-50">
            <div class="container mx-auto px-4 py-3 space-y-3">
                <a href="index.html" class="block hover:text-orange-500 transition">Home</a>
                <a href="journal.html" class="block hover:text-orange-500 transition">Journal</a>
                <a href="gallery.html" class="block hover:text-orange-500 transition">Trophy Room</a>
                <a href="videos.html" class="block hover:text-orange-500 transition">Videos</a>
                <a href="contact.html" class="block hover:text-orange-500 transition">Uploads</a>
            </div>
        </div>
    </header>

    <main class="pt-24 pb-16 min-h-screen">
        <section id="videos" class="py-16">
            <div class="container mx-auto px-4">
                <h1 class="text-4xl font-bold mb-2 text-center">
                    <span class="text-orange-500">Hunting</span> Videos
                </h1>
                <p class="text-center text-gray-400 mb-12">Adventures, tips, and memorable moments from the field</p>
                
                <div id="videoGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="text-center text-gray-400 col-span-full py-8">
                        <p>No videos added yet. Add video URLs to display them here.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal for playing videos -->
    <div id="videoModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/80 px-4 py-8">
        <div id="videoModalContent" class="relative w-full max-w-5xl">
            <button id="videoModalClose" class="absolute -top-4 -right-4 bg-gray-800 hover:bg-gray-700 text-white rounded-full p-2">✕</button>
            <div id="videoModalInner" class="bg-black rounded-lg overflow-hidden">
                <!-- iframe will be injected here. keeps 16:9 -->
                <div id="videoFrameWrapper" style="position:relative;width:100%;padding-top:56.25%;">
                    <!-- Prev/Next controls -->
                    <button id="videoPrev" class="absolute left-2 top-1/2 -translate-y-1/2 bg-gray-800/70 hover:bg-gray-700 text-white rounded-full p-2 z-10">◀</button>
                    <button id="videoNext" class="absolute right-2 top-1/2 -translate-y-1/2 bg-gray-800/70 hover:bg-gray-700 text-white rounded-full p-2 z-10">▶</button>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-gray-800 text-center py-6 border-t border-gray-700">
        <p>&copy; 2024 Hunting Chronicle's. All rights reserved.</p>
    </footer>

    <script>
        // Add your YouTube video URLs here
        const videos = [
            'https://youtu.be/Rp44UiWZeNA?si=WGFuOO-0-oV0Egm4',
            'https://www.youtube.com/watch?v=muzneRfjZ_A&si=9gIwBq36z3vG5izB',
            'https://www.youtube.com/watch?v=YZ9aWQqD3K8'
        ];

        // Parse id and preserve si parameter if present
        function parseVideo(url) {
            let id = '';
            let si = '';
            if (url.includes('youtube.com/watch')) {
                const idMatch = url.match(/v=([^&]+)/);
                id = idMatch ? idMatch[1] : '';
                const siMatch = url.match(/si=([^&]+)/);
                si = siMatch ? siMatch[1] : '';
            } else if (url.includes('youtu.be/')) {
                const idMatch = url.match(/youtu\.be\/([^?&]+)/);
                id = idMatch ? idMatch[1] : '';
                const siMatch = url.match(/si=([^&]+)/);
                si = siMatch ? siMatch[1] : '';
            }
            return { id, si, original: url };
        }

        // Build embed src with preserved si param and enablejsapi for error detection
        function buildEmbedSrc(id, si, opts = {}) {
            let src = `https://www.youtube.com/embed/${id}`;
            const params = [];
            if (si) params.push(`si=${si}`);
            // enable JS API so we can listen for player errors
            params.push('enablejsapi=1');
            params.push('rel=0');
            params.push('playsinline=1');
            params.push('modestbranding=1');
            if (opts.autoplay) params.push('autoplay=1');
            // Add origin param when available (helps YouTube validate the embed referrer).
            try {
                if (location && location.protocol && location.protocol.startsWith('http')) {
                    const origin = encodeURIComponent(location.origin);
                    params.push(`origin=${origin}`);
                }
            } catch (e) {
                // ignore — if origin can't be determined, we skip adding it
            }

            if (params.length) src += `?${params.join('&')}`;
            return src;
        }

        // Insert thumbnails and wire click -> modal player
        const videosData = []; // store parsed video objects for modal playback
        function loadVideos() {
            const videoGrid = document.getElementById('videoGrid');
            if (!videoGrid) return;
            videoGrid.innerHTML = '';

            videos.forEach((url, idx) => {
                const { id, si, original } = parseVideo(url);
                if (!id) {
                    const linkDiv = document.createElement('div');
                    linkDiv.className = 'rounded-lg overflow-hidden shadow-xl bg-gray-800 flex items-center justify-center h-64';
                    linkDiv.innerHTML = `<a href="${original}" target="_blank" class="text-orange-500 hover:text-orange-400 underline text-center px-4">Invalid URL<br><small>Click to open on YouTube</small></a>`;
                    videoGrid.appendChild(linkDiv);
                    return;
                }

                // thumbnail URL (fallback to hqdefault)
                const thumb = `https://i.ytimg.com/vi/${id}/hqdefault.jpg`;
                // basic title via oEmbed (pre-fetched)
                const titles = {
                    'Rp44UiWZeNA': 'Masons 11point Buck Short Version',
                    'muzneRfjZ_A': 'Mason first hunt',
                    'YZ9aWQqD3K8': '11 point'
                };
                const title = titles[id] || 'YouTube Video';

                const card = document.createElement('div');
                card.className = 'rounded-lg overflow-hidden shadow-xl bg-gray-800 cursor-pointer';
                card.innerHTML = `
                    <div class="relative">
                        <img src="${thumb}" alt="Video thumbnail" class="w-full h-48 object-cover">
                        <div class="absolute inset-0 flex items-center justify-center">
                            <div class="bg-black/50 rounded-full p-4">
                                <svg class="w-10 h-10 text-white" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"></path></svg>
                            </div>
                        </div>
                    </div>
                    <div class="p-4 text-left">
                        <p class="text-sm text-gray-300">${title}</p>
                        <p class="text-xs text-gray-400">Scott Rindahl</p>
                        <a class="text-orange-500 hover:text-orange-400 text-sm truncate" href="${original}" target="_blank">Open on YouTube</a>
                    </div>
                `;

                // click opens modal
                card.addEventListener('click', () => {
                    openVideoModal({ id, si, original, index: idx });
                });

                videoGrid.appendChild(card);
                videosData.push({ id, si, original });
            });
        }

        // Queue of players to initialize once API is ready
        const playersToInit = [];

        // Load YouTube IFrame API and initialize players
        function initYouTubeAPI() {
            if (typeof YT === 'undefined' || typeof YT.Player === 'undefined') {
                // load the API script
                const tag = document.createElement('script');
                tag.src = 'https://www.youtube.com/iframe_api';
                document.body.appendChild(tag);
            } else {
                onYouTubeIframeAPIReady();
            }
        }

        // This function is called by the IFrame API when ready
        function onYouTubeIframeAPIReady() {
            playersToInit.forEach(item => {
                try {
                    new YT.Player(item.id, {
                        events: {
                            onError: function(event) {
                                // If player gives an error (101/150/153 etc.), replace with a link
                                const container = item.container;
                                container.innerHTML = `<div class="p-6 text-center"><a href="${item.original}" target="_blank" class="text-orange-500 hover:text-orange-400 underline">Unable to embed video<br><small>Click to watch on YouTube</small></a></div>`;
                            }
                        }
                    });
                } catch (e) {
                    // If anything goes wrong, fallback to link
                    const container = item.container;
                    container.innerHTML = `<div class="p-6 text-center"><a href="${item.original}" target="_blank" class="text-orange-500 hover:text-orange-400 underline">Unable to embed video<br><small>Click to watch on YouTube</small></a></div>`;
                }
            });
        }

        // Start
        loadVideos();
        initYouTubeAPI();

        // Modal helpers: on-demand modal player using YT.Player to detect embed errors
        const modal = document.getElementById('videoModal');
        const modalClose = document.getElementById('videoModalClose');
        const videoFrameWrapper = document.getElementById('videoFrameWrapper');
        const videoPrev = document.getElementById('videoPrev');
        const videoNext = document.getElementById('videoNext');
        // enhance modal size and simple fade
        const modalContent = document.getElementById('videoModalContent');
        if (modalContent) modalContent.classList.add('transition', 'ease-out', 'duration-200');
        let currentPlayer = null;

        let currentIndex = -1;
        function openVideoModal({ id, si, original, index }) {
            if (!modal || !videoFrameWrapper) return;
            // clear previous content
            videoFrameWrapper.innerHTML = '';
            // re-append controls after clearing
            if (videoPrev && !videoFrameWrapper.contains(videoPrev)) videoFrameWrapper.appendChild(videoPrev);
            if (videoNext && !videoFrameWrapper.contains(videoNext)) videoFrameWrapper.appendChild(videoNext);
            currentIndex = typeof index === 'number' ? index : -1;

            // create responsive iframe (16:9)
            const iframe = document.createElement('iframe');
            iframe.id = 'modal-player';
            iframe.width = '100%';
            iframe.height = '100%';
            iframe.frameBorder = '0';
            iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share';
            iframe.referrerPolicy = 'strict-origin-when-cross-origin';
            iframe.allowFullscreen = true;
            iframe.style.position = 'absolute';
            iframe.style.top = '0';
            iframe.style.left = '0';
            iframe.style.width = '100%';
            iframe.style.height = '100%';
            iframe.style.zIndex = '0';

            iframe.src = buildEmbedSrc(id, si, { autoplay: true });
            videoFrameWrapper.appendChild(iframe);

            // show modal
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            if (modalContent) {
                modalContent.style.opacity = '0';
                requestAnimationFrame(() => { modalContent.style.opacity = '1'; });
            }

            // If YT API available, attach player to detect errors (onError: show link)
            try {
                if (typeof YT !== 'undefined' && YT && YT.Player) {
                    if (currentPlayer && typeof currentPlayer.destroy === 'function') {
                        try { currentPlayer.destroy(); } catch (e) {}
                        currentPlayer = null;
                    }
                    currentPlayer = new YT.Player('modal-player', {
                        playerVars: { autoplay: 1, rel: 0, playsinline: 1, modestbranding: 1 },
                        events: {
                            onReady: function(e){
                                try {
                                    e.target.playVideo();
                                    setTimeout(() => {
                                        try {
                                            if (typeof YT !== 'undefined' && YT.PlayerState && e.target.getPlayerState() !== YT.PlayerState.PLAYING) {
                                                e.target.mute();
                                                e.target.playVideo();
                                            }
                                        } catch (_) {}
                                    }, 700);
                                } catch(_) {}
                            },
                            onError: function(){
                                videoFrameWrapper.innerHTML = `<div class=\"p-6 text-center\"><a href=\"${original}\" target=\"_blank\" class=\"text-orange-500 hover:text-orange-400 underline\">Unable to embed video<br><small>Click to watch on YouTube</small></a></div>`;
                            }
                        }
                    });
                }
            } catch (e) {
                // ignore and allow iframe to attempt playback; fallback will be applied if error fires
            }
        }

        function closeVideoModal() {
            if (!modal || !videoFrameWrapper) return;
            if (currentPlayer && typeof currentPlayer.destroy === 'function') {
                try { currentPlayer.destroy(); } catch (e) {}
                currentPlayer = null;
            }
            videoFrameWrapper.innerHTML = '';
            if (modalContent) {
                modalContent.style.opacity = '1';
                requestAnimationFrame(() => { modalContent.style.opacity = '0'; });
            }
            modal.classList.remove('flex');
            modal.classList.add('hidden');
            currentIndex = -1;
        }

        if (modalClose) modalClose.addEventListener('click', closeVideoModal);
        if (modal) modal.addEventListener('click', (e) => { if (e.target === modal) closeVideoModal(); });

        // navigation helpers
        function showByIndex(nextIndex) {
            if (nextIndex < 0 || nextIndex >= videosData.length) return;
            const vid = videosData[nextIndex];
            openVideoModal({ id: vid.id, si: vid.si, original: vid.original, index: nextIndex });
        }
        if (videoPrev) videoPrev.addEventListener('click', (e) => { e.stopPropagation(); if (currentIndex > 0) showByIndex(currentIndex - 1); });
        if (videoNext) videoNext.addEventListener('click', (e) => { e.stopPropagation(); if (currentIndex >= 0 && currentIndex < videosData.length - 1) showByIndex(currentIndex + 1); });
        // clicking the video area should unmute if we had to mute for autoplay
        if (videoFrameWrapper) videoFrameWrapper.addEventListener('click', (e) => {
            if (currentPlayer && typeof currentPlayer.unMute === 'function') {
                try { currentPlayer.unMute(); currentPlayer.playVideo(); } catch (_) {}
            }
        });
        // keyboard: Esc to close, arrows to navigate
        document.addEventListener('keydown', (e) => {
            if (modal.classList.contains('hidden')) return;
            if (e.key === 'Escape') closeVideoModal();
            if (e.key === 'ArrowLeft' && currentIndex > 0) showByIndex(currentIndex - 1);
            if (e.key === 'ArrowRight' && currentIndex >= 0 && currentIndex < videosData.length - 1) showByIndex(currentIndex + 1);
        });

        // Expose the API-ready handler to the global scope (YouTube will call this)
        window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;
        </script>
        <script>
        // Mobile nav toggle
        (function(){
          const btn = document.getElementById('mobileMenuButton');
          const panel = document.getElementById('mobileNav');
          const backdrop = document.getElementById('mobileBackdrop');
          if (!btn || !panel || !backdrop) return;
          function closeMenu() { panel.style.transform = 'translateY(-100%)'; backdrop.style.opacity = '0'; backdrop.style.pointerEvents = 'none'; btn.setAttribute('aria-expanded', 'false'); }
          function openMenu() { panel.style.transform = 'translateY(0)'; backdrop.style.opacity = '1'; backdrop.style.pointerEvents = 'auto'; btn.setAttribute('aria-expanded', 'true'); }
          btn.addEventListener('click', function(){ const isOpen = backdrop.style.pointerEvents === 'auto'; if (isOpen) closeMenu(); else openMenu(); });
          backdrop.addEventListener('click', closeMenu);
          panel.querySelectorAll('a').forEach(a => a.addEventListener('click', () => { setTimeout(closeMenu, 250); }));
        })();
        </script>
</body>
</html>
